{% extends 'base.html' %}

{% block content %}

<h2>{{ sistema.nombre }}</h2>

<hr>

<h3>ðŸ“Š SoluciÃ³n Final</h3>

<ul>
    {% for var, val in pares %}
        <li><strong>{{ var }}</strong> = {{ val|floatformat:6 }}</li>
    {% endfor %}
</ul>

<p><strong>Iteraciones:</strong> {{ solucion.iteraciones_usadas }}</p>

<hr>

<h3>ðŸ“ˆ Tabla de Iteraciones</h3>

<table border="1" cellpadding="6">
    <thead>
        <tr>
            <th>Iter</th>
            {% for var in variables %}
                <th>{{ var }}</th>
                <th>Error {{ var }}%</th>
            {% endfor %}
        </tr>
    </thead>

    <tbody>
        {% for iter in tabla_datos %}
            <tr>
                <td>{{ iter.numero }}</td>

                {% for val in iter.valores %}
                    <td>{{ val|floatformat:6 }}</td>
                {% endfor %}

                {% for err in iter.errores %}
                    <td>{{ err|floatformat:4 }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

<hr>

<h3>ðŸ“‰ GrÃ¡fica de Convergencia</h3>

<canvas id="graficaErrores" width="400" height="180"></canvas>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Convertir datos del backend sin generar errores de sintaxis
    const iteraciones = JSON.parse('{{ iteraciones_nums|escapejs }}');
    const errores = JSON.parse('{{ errores_promedio|escapejs }}');

    const ctx = document.getElementById('graficaErrores').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: iteraciones,
            datasets: [{
                label: 'Error promedio por iteraciÃ³n',
                data: errores,
                borderWidth: 2,
                tension: 0.2,
                pointRadius: 4,
                borderColor: 'red',
                backgroundColor: 'rgba(255,0,0,0.2)',
                fill: false
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: false }
            }
        }
    });
</script>

{% endblock %}
